<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Thêm viewport để tối ưu hóa di động -->
    <title>越南语听力练习</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            text-align: center; 
            margin: 0; 
            padding-bottom: 300px; /* Mặc định cho màn hình lớn */
            background-color: #f7fbf3; /*f7fbf3  3f4040*/
        }
        #gameContainer {
            display: block;
            min-height: calc(100vh - 150px); /* Đảm bảo nội dung chiếm đủ chiều cao màn hình */
        }
        #infoBox { 
            width: 95%; 
            max-width: 700px;
            min-height: 100px; 
            margin: 0 auto; 
            border: 2px solid #91b66f; /*041b31 1f4263*/
            background: #85ae5f; /*ecf2e4 fefefc*/
            color: #ffffff; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: clamp(40px, 5vw, 60px);
            font-weight: bold;
        }
        #contactBox { 
            width: 90%; 
            max-width: 700px;
            min-height: 25px; 
            margin: 0px auto; 
            border: 2px solid #91b66f; 
            background: #85ae5f; 
            color: #f1c232; 
            display: flex; 
            align-items: center; 
            justify-content: left; 
            padding-left: 20px;
            font-size: clamp(16px, 2vw, 20px); 
            font-weight: bold;
        }
        #instructionBox { 
            width: 90%; 
            max-width: 700px;
            min-height: 25px; 
            margin: 0px auto; 
            border: 2px solid #91b66f; 
            background: #85ae5f; 
            color: #f7e19c; 
            display: flex; 
            align-items: center; 
            justify-content: left; 
            padding-left: 20px;
            font-size: clamp(16px, 2vw, 20px); 
            font-weight: bold;
        }
        #controls { 
            position: fixed; /* Cố định ở cuối màn hình */
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 95%;
            max-width: 800px; /* Giới hạn chiều rộng tối đa */
            background: #f7fbf3;
                        border: 3px solid #f7fbf3;                        
            padding: 10px 0; 
           /* box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.2); */
            z-index: 1000; 
        }
        #controls div {
            margin: 5px 0; 
            display: flex;
            justify-content: center;
            align-items: center;
        }
        button { 
            padding: 8px 8px; 
            margin: 0 5px; 
            cursor: pointer; 
            border: 2px solid #85ae5f; 
            background: #85ae5f; /*192332*/
                        box-shadow: 0 5px 5px rgba(0, 0, 0, 0.2);
            color: #fffbef; 
            font-size: 28px; 
            border-radius: 5px; 
        }
        #sentenceNumber { 
            width: 50px; 
            padding: 10px; 
            text-align: center; 
            border: 3px solid #85ae5f; /*041b31 68838B*/
            background: #f1cc76; 
            color: #000; 
            border-radius: 10px; 
            font-size: 16px; 
            -moz-appearance: textfield; 
        }
        #sentenceNumber::-webkit-inner-spin-button, 
        #sentenceNumber::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        #sentenceNumber:disabled { 
            background: #eee; 
        }
        .disabled { 
            cursor: not-allowed; 
            pointer-events: none; 
        }
        .active-mode { 
            border: 2px solid #fed16a; 
        }
        #indicator { 
            width: 95%;
                        max-width: 700px; 
            min-height: 50px; 
            margin: 10px auto; 
                        padding: 5px;
            border: 3px solid #fed16a; 
            background: #ffffe0; 
            border-radius: 10px; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
        }
        #optionsContainer {
            width: 100%;
            max-width: 700px;
            margin: 10px auto;
        }
        .optionBtn {
            width: 95%; 
            max-width: 700px;
            padding: 10px;
            margin: 5px 0;
            border: 2px solid #ffffff;
            background: #ffffff; /*E6EDD9*/
            color: #000000;
                        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            font-size: 30px;
            text-align: left;
            cursor: pointer;
            border-radius: 5px;
        }
        .optionBtn:hover {
            background: #D2E4C4;
        }
        .correct {
            background: #B7D7AA !important;
        }
        .wrong {
            background: #CE6D5E !important;
        }
        #score { 
            display: none; 
            width: 100%;
            max-width: 700px;
            margin: 10px auto; 
            color: #FF6820; 
            font-size: 30px; 
            text-align: center;
        }
        #wrongSentences { 
            display: none; 
            width: 95%; 
            max-width: 700px; 
            margin: 10px auto; 
            padding: 10px; 
            border: 2px solid #CE6D5E; 
            background: #FFF0F0; 
            color: #CE6D5E; 
            font-size: 30px; 
            text-align: left; 
            border-radius: 5px; 
        }
        #results { 
            display: none; 
            width: 95%;
            max-width: 700px;        
            margin: 10px auto; 
            padding: 10px; 
            border: 2px solid #734A2E; 
            background: #fffbef; 
            color: #000; 
            font-size: 30px; 
            text-align: left; 
            border-radius: 5px; 
            white-space: pre-line;
        }

        /* Media query cho thiết bị di động */
        @media (max-width: 768px) {
            body {
                padding-bottom: 200px; /* Giảm padding-bottom cho điện thoại */
            }
            #controls {
                padding: 5px 0; /* Giảm padding */
            }
            button {
                padding: 6px 6px; /* Giảm kích thước nút */
                font-size: 20px; /* Giảm kích thước chữ */
            }
            #sentenceNumber {
                width: 40px; /* Giảm chiều rộng */
                padding: 8px; /* Giảm padding */
                font-size: 14px; /* Giảm kích thước chữ */
            }
            .optionBtn {
                font-size: 20px; /* Giảm kích thước chữ cho đáp án */
                padding: 8px; /* Giảm padding */
            }
            #infoBox {
                font-size: clamp(30px, 4vw, 40px); /* Giảm kích thước chữ */
            }
            #contactBox, #instructionBox {
                font-size: clamp(14px, 2vw, 16px); /* Giảm kích thước chữ */
            }
            #indicator {
                min-height: 40px; /* Giảm chiều cao tối thiểu */
            }
            #results, #wrongSentences, #score {
                font-size: 24px; /* Giảm kích thước chữ */
                                width: 90%;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="infoBox">习得越南语<br>听力练习</div>
        <div id="contactBox">讲师-阮玉煌 | Weixin：XiDeYueNanYu</div>
        <div id="instructionBox">选择与播放内容相符的选项</div>
        <div id="indicator"></div>
        <div id="optionsContainer"></div>
        <div id="results"></div>
        <div id="score">0/0</div>
        <div id="wrongSentences"></div>
    </div>
    <div id="controls">
        <div>
            <button id="freeModeBtn" class="active-mode">自由模式</button>
            <button id="testModeBtn">作业模式</button>
        </div>
        <div>
            <button id="autoContinueBtn">自动继续</button>
            <button id="showHideBtn">显示-隐藏</button>
        </div>
        <div>
            <button id="prevBtn">◀</button>
            <input type="text" id="sentenceNumber" inputmode="numeric" pattern="[0-9]*">
            <button id="nextBtn">▶</button>
            <button id="replayBtn">再听一遍</button>
        </div>
    </div>
    <audio id="mainAudio" src="audio.mp3"></audio>
    <audio id="correctAudio" src="Dung.mp3"></audio>
    <audio id="wrongAudio" src="Sai.mp3"></audio>

    <script>
        const audio = document.getElementById('mainAudio');
        const correctAudio = document.getElementById('correctAudio');
        const wrongAudio = document.getElementById('wrongAudio');
        const indicator = document.getElementById('indicator');
        const sentenceNumber = document.getElementById('sentenceNumber');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const replayBtn = document.getElementById('replayBtn');
        const freeModeBtn = document.getElementById('freeModeBtn');
        const testModeBtn = document.getElementById('testModeBtn');
        const autoContinueBtn = document.getElementById('autoContinueBtn');
        const showHideBtn = document.getElementById('showHideBtn');
        const scoreDisplay = document.getElementById('score');
        const wrongSentencesDisplay = document.getElementById('wrongSentences');
        const optionsContainer = document.getElementById('optionsContainer');
        const resultsDisplay = document.getElementById('results');

        const buttons = [prevBtn, nextBtn, replayBtn, freeModeBtn, testModeBtn, autoContinueBtn, showHideBtn];

const sentences = [
    {
        "audioFile": "audio1.mp3",
        "start": 0.003528,
        "end": 0.065464,
        "correctAnswer": "呼叫",
        "translation": "越南语语气助词 ơi 用来。。。？",
        "options": [
            "呼叫",
            "询问",
            "感叹"
        ]
    },
    {
        "audioFile": "audio1.mp3",
        "start": 0.003528,
        "end": 0.065464,
        "correctAnswer": "呼叫",
        "translation": "越南语语气助词 ơi 单独使用时表示。。。？",
        "options": [
            "叫别人",
            "回答-我听见了",
            "回答-叫什么叫"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 0.441542,
        "end": 1.561542,
        "correctAnswer": "Lan ơi !",
        "translation": "(阿)兰！",
        "options": [
            "Lan ơi !",
            "Lăn ơi !",
            "Nan ơi !",
            "Len ơi !"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 2.011542,
        "end": 3.031542,
        "correctAnswer": "Anh ơi !",
        "translation": "哥哥！",
        "options": [
            "Ănh ơi !",
            "Anh ơi !",
            "Oanh ơi !",
            "Ênh ơi !"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 3.501542,
        "end": 4.871542,
        "correctAnswer": "Chị Hoa ơi !",
        "translation": "(阿)花姐姐！",
        "options": [
            "Chị Hoa ơi !",
            "Chị Hòa ơi !",
            "Dị Hoa ơi !",
            "Chị Hôa ơi !"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 5.301542,
        "end": 6.351542,
        "correctAnswer": "Ông ơi !",
        "translation": "爷爷！",
        "options": [
            "Ôn ơi !",
            "Ông ơi !",
            "Ôm ơi !",
            "Âng ơi !"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 6.751542,
        "end": 8.071542,
        "correctAnswer": "Bà Mai ơi !",
        "translation": "(阿)梅奶奶！",
        "options": [
            "Bà Mai ơi !",
            "Bà Mái ơi !",
            "Bà Mơi ơi !",
            "Mà Mai ơi !"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 8.661542,
        "end": 9.731542,
        "correctAnswer": "Bạn ơi !",
        "translation": "朋友！",
        "options": [
            "Bạn ơi !",
            "Bạn ới !",
            "Vạn ơi !",
            "Bạt ơi !"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 10.251542,
        "end": 11.391542,
        "correctAnswer": "Thầy ơi !",
        "translation": "老师！",
        "options": [
            "Thầy ơi !",
            "Thấy ơi !",
            "Thây ơi !",
            "Dầy ơi !"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 11.911542,
        "end": 13.271542,
        "correctAnswer": "Cô Nga ơi !",
        "translation": "(阿)娥老师！",
        "options": [
            "Cô Nga ơi !",
            "Cô Nha ơi !",
            "Cô Ngà ơi !",
            "Gô Nga ơi !"
        ]
    },
    {
        "audioFile": "audio1.mp3",
        "start": 0.003528,
        "end": 0.065464,
        "correctAnswer": "这-放数-量-名词后作定语",
        "translation": "指示代词 này 是什么意思，怎么用？",
        "options": [
            "这-放数-量-名词后作定语",
            "那-放数-量-名词后作定语",
            "这-句首作主语"
        ]
    },
    {
        "audioFile": "audio1.mp3",
        "start": 0.003528,
        "end": 0.065464,
        "correctAnswer": "Đây là...",
        "translation": "越南语怎么表达：这是...？",
        "options": [
            "Đây là...",
            "Này là ...",
            "Đấy là..."
        ]
    },
    {
        "audioFile": "audio1.mp3",
        "start": 0.003528,
        "end": 0.065464,
        "correctAnswer": "Đây là...",
        "translation": "越南语怎么表达：这个（东西，动物，人...）...？",
        "options": [
            "(cái,con,người...) đây",
            "(cái,con,người...) này",
            "(cái,con,người...) đấy"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 13.731542,
        "end": 16.621542,
        "correctAnswer": "Đây là cái bút, cái bút này tốt.",
        "translation": "这是笔，这支笔很好。",
        "options": [
            "Đây là cái bút, cái bút này tốt.",
            "Đây là cái bụt, cái bụt này tốt.",
            "Đây là cái bút, cái bút này tót.",
            "Đây là cái vút, cái bút này tốt."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 16.991542,
        "end": 20.151542,
        "correctAnswer": "Đây là bức tranh, bức tranh này xấu.",
        "translation": "这是画，这幅画不好看。",
        "options": [
            "Đây là bức chanh, bức chanh này xấu.",
            "Đây là bức tranh, bức tranh này xấu.",
            "Đây là bức tranh, bức tranh này xẩu.",
            "Đây là bước tranh, bức tranh này xấu."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 20.551542,
        "end": 23.841542,
        "correctAnswer": "Đấy là con gà, con gà ấy béo.",
        "translation": "那是只鸡，那只鸡很胖。",
        "options": [
            "Đấy là con gà, con gà ấy béo.",
            "Đấy là con cá, con gà ấy béo.",
            "Đấy là con gà, con gà ấy bếu.",
            "Đấy là con gà, con gá ấy béo."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 24.481542,
        "end": 27.631542,
        "correctAnswer": "Kia là con trâu, con trâu ấy gầy.",
        "translation": "那是头水牛，那头水牛很瘦。",
        "options": [
            "Kia là con trơu, con trâu ấy gầy.",
            "Kia là con trơu, con trâu ấy gẫy.",
            "Kia là con trâu, con trâu ấy gầy.",
            "Kia là con châu, con trâu ấy gầy."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 28.291542,
        "end": 31.481542,
        "correctAnswer": "Đó là quyển từ điển, quyển từ điển đó đắt.",
        "translation": "那是词典，那本词典很贵。",
        "options": [
            "Đó là quyển từ điển, quyển từ điển đó đắt.",
            "Đó là quyển từ điển, quyển từ điển đó dát.",
            "Đó là quyển từ điển, quyển tờ điển đó đắt.",
            "Đó là quyền từ điển, quyển từ điển đó đắt."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 31.971542,
        "end": 35.011542,
        "correctAnswer": "Đây là đôi giày, đôi giày này rẻ.",
        "translation": "这是双鞋，这双鞋很便宜。",
        "options": [
            "Đây là đôi giày, đôi giày này rẻ.",
            "Đây là đôi giày, đôi giày này rễ.",
            "Đây là đôi gày, đôi giày này rẻ.",
            "Đây là đơi giày, đôi giày này rẻ."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 35.621542,
        "end": 38.661542,
        "correctAnswer": "Đấy là quả vải, quả vải ấy ngon.",
        "translation": "那是荔枝，那荔枝很好吃。",
        "options": [
            "Đấy là quả vải, quả vải ấy ngon.",
            "Đấy là quả vài, quả vải ấy ngon.",
            "Đấy là quả vải, quả vải ấy ngôn.",
            "Đấy là quả phai, quả vải ấy ngon."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 39.191542,
        "end": 42.141542,
        "correctAnswer": "Kia là bông hoa, bông hoa ấy đẹp.",
        "translation": "那是朵花，那朵花很漂亮。",
        "options": [
            "Kia là bông hoa, bông hoa ấy đẹp.",
            "Kia là bông khoa, bông hoa ấy đẹp.",
            "Kia là bông hoa, bông hoa ấy đep.",
            "Kia là bóng hoa, bông hoa ấy đẹp."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 42.621542,
        "end": 45.441542,
        "correctAnswer": "Đó là cái kính, cái kính ấy xấu.",
        "translation": "那是眼镜，那副眼镜不好看。",
        "options": [
            "Đó là cái kính, cái kính ấy xấu.",
            "Đó là cái kính, cái kính ấy xẩu.",
            "Đó là cái kình, cái kính ấy xấu.",
            "Đó là cái khính, cái kính ấy xấu."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 45.981542,
        "end": 48.901542,
        "correctAnswer": "Đây là quyển sách, quyển sách này mỏng.",
        "translation": "这是书，这本书很薄。",
        "options": [
            "Đây là quyển sách, quyển sách này mỏng.",
            "Đây là quyền sách, quyển sách này mỏng.",
            "Đây là quyển sách, quyển sách này mỗng.",
            "Đây là quyển sách, quyển sách này mõng."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 49.511542,
        "end": 52.461542,
        "correctAnswer": "Đấy là cuốn lịch, cuốn lịch đó dày.",
        "translation": "那是日历，那本日历很厚。",
        "options": [
            "Đấy là cuốn lịch, cuốn lịch đó dày.",
            "Đấy là cuốn địch, cuốn lịch đó dày.",
            "Đấy là cuốn lịch, cuốn lịch đó dáy.",
            "Đấy là cuốn lịch, cuốn lịch đó dại."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 53.021542,
        "end": 56.241542,
        "correctAnswer": "Kia là bài toán, bài toán ấy khó.",
        "translation": "那是道数学题，那道题很难。",
        "options": [
            "Kia là bài toán, bài toán ấy khó.",
            "Kia là bài toán, bài toán ấy khô.",
            "Kia là bài toàn, bài toán ấy khó.",
            "Kia là bày toán, bài toán ấy khó."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 56.711542,
        "end": 59.601542,
        "correctAnswer": "Đó là bài toán, bài toán ấy dễ.",
        "translation": "那是道数学题，那道题很简单。",
        "options": [
            "Đó là bài toán, bài toán ấy dễ.",
            "Đó là bại toán, bài toán ấy dễ.",
            "Đó là bài toán, bài toán ấy dể.",
            "Đó là bài toan, bài toán ấy dễ."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 60.281542,
        "end": 63.101542,
        "correctAnswer": "Đây là cái mũ, cái mũ này mới.",
        "translation": "这是帽子，这顶帽子是新的。",
        "options": [
            "Đây là cái mũ, cái mũ này mới.",
            "Đây là cái mũ, cái mũ này muối.",
            "Đây là cái mủ, cái mũ này mới.",
            "Đây là cái mũ, cái mũ này mơi."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 63.571542,
        "end": 66.551542,
        "correctAnswer": "Đấy là cái ghế, cái ghế đó cũ.",
        "translation": "那是椅子，那张椅子是旧的。",
        "options": [
            "Đấy là cái ghế, cái ghế đó cũ.",
            "Đấy là cái ghế, cái ghế đó củ.",
            "Đấy là cái ghể, cái ghế đó cũ.",
            "Đấy là cái kế, cái ghế đó cũ."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 67.151542,
        "end": 70.181542,
        "correctAnswer": "Kia là con chuột, con chuột ấy nhỏ.",
        "translation": "那是老鼠，那只老鼠很小。",
        "options": [
            "Kia là con chuột, con chuột ấy nhỏ.",
            "Kia là con chuột, con chuột ấy nhõ.",
            "Kia là con chột, con chuột ấy nhỏ.",
            "Kia là con chuột, con suột ấy nhỏ."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 70.791542,
        "end": 73.841542,
        "correctAnswer": "Đó là con voi, con voi ấy to.",
        "translation": "那是大象，那头大象很大。",
        "options": [
            "Đó là con voi, con voi ấy to.",
            "Đó là con voi, con voi ấy tô.",
            "Đó là con voi, con soi ấy to.",
            "Đó là con vôi, con voi ấy to."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 74.341542,
        "end": 75.981542,
        "correctAnswer": "Ngôi nhà ấy thế nào?",
        "translation": "那栋房子怎么样？",
        "options": [
            "Ngôi nhà ấy thế nào?",
            "Ngôi nhá ấy thế nào?",
            "Ngôi nhà ấy thề nào?",
            "Ngôi nhà ấy thê nào?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 76.461542,
        "end": 77.791542,
        "correctAnswer": "Ngôi nhà ấy đẹp.",
        "translation": "那栋房子很漂亮。",
        "options": [
            "Ngôi nhà ấy đẹp.",
            "Ngôi nhà ấy đep.",
            "Ngôi nha ấy đẹp.",
            "Ngôi nhà ấy dẹp."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 78.411542,
        "end": 80.191542,
        "correctAnswer": "Chiếc xe máy ấy thế nào?",
        "translation": "那辆摩托车怎么样？",
        "options": [
            "Chiếc xe máy ấy thế nào?",
            "Chiếc xe mải ấy thế nào?",
            "Chiếc se máy ấy thế nào?",
            "Chiếc xe máy ấy thề nào?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 80.641542,
        "end": 82.181542,
        "correctAnswer": "Chiếc xe máy ấy tốt.",
        "translation": "那辆摩托车很好。",
        "options": [
            "Chiếc xe máy ấy tốt.",
            "Chiếc xe máy ấy tót.",
            "Chiếc xe mấy ấy tốt.",
            "Chiếc che máy ấy tốt."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 82.721542,
        "end": 84.941542,
        "correctAnswer": "Cái đồng hồ đeo tay đó thế nào?",
        "translation": "那块手表怎么样？",
        "options": [
            "Cái đồng hồ đeo tay đó thế nào?",
            "Cái đồng hồ đeo tay đó thê nào?",
            "Cái đồng hồ đeo tai đó thế nào?",
            "Cái đồng hồ đeo tay đó tể nào?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 85.311542,
        "end": 87.131542,
        "correctAnswer": "Cái đồng hồ đeo tay đó đắt.",
        "translation": "那块手表很贵。",
        "options": [
            "Cái đồng hồ đeo tay đó đắt.",
            "Cái đồng hồ đeo tay đó dát.",
            "Cái đồng hồ đeo tai đó đắt.",
            "Cái đồng hồ đeo tay đó đát."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 87.821542,
        "end": 89.621542,
        "correctAnswer": "Quả chuối ấy có ngon không?",
        "translation": "那根香蕉好吃吗？",
        "options": [
            "Quả chuối ấy có ngon không?",
            "Quả chuối ấy cố ngon không?",
            "Quả chuối ấy có ngôn không?",
            "Quả chối ấy có ngon không?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 90.031542,
        "end": 91.471542,
        "correctAnswer": "Quả chuối ấy ngon.",
        "translation": "那根香蕉很好吃。",
        "options": [
            "Quả chuối ấy ngon.",
            "Quả chuối ấy ngọn.",
            "Quả chươi ấy ngon.",
            "Quả chuối ấy gon."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 91.991542,
        "end": 93.841542,
        "correctAnswer": "Quả dứa ấy có chua không.",
        "translation": "那个菠萝酸吗？",
        "options": [
            "Quả dứa ấy có chua không.",
            "Quả dứa ấy có chụa không.",
            "Quả dứa ấy có sua không.",
            "Quả dứa ấy cố chua không."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 94.321542,
        "end": 95.791542,
        "correctAnswer": "Quả dứa ấy chua.",
        "translation": "那个菠萝很酸。",
        "options": [
            "Quả dứa ấy chua.",
            "Quả dứa ấy chúa.",
            "Quả dứa ấy sua.",
            "Quả lứa ấy chua."
        ]
    },
    {
        "audioFile": "audio1.mp3",
        "start": 0.003528,
        "end": 0.065464,
        "correctAnswer": "形容词前",
        "translation": "程度副词 rất 放哪里？",
        "options": [
            "形容词前",
            "形容词后",
            "动词前"
        ]
    },
    {
        "audioFile": "audio1.mp3",
        "start": 0.003528,
        "end": 0.065464,
        "correctAnswer": "形容词后",
        "translation": "程度副词 lắm 放哪里？",
        "options": [
            "形容词前",
            "形容词后",
            "动词前"
        ]
    },
    {
        "audioFile": "audio1.mp3",
        "start": 0.003528,
        "end": 0.065464,
        "correctAnswer": "形容词前面或者后面",
        "translation": "程度副词 quá 放哪里？",
        "options": [
            "形容词前",
            "形容词后",
            "形容词前面或者后面"
        ]
    },
    {
        "audioFile": "audio1.mp3",
        "start": 0.003528,
        "end": 0.065464,
        "correctAnswer": "不能",
        "translation": "程度副词 rất,lắm, quá 可以在一个句子里同时出现吗？",
        "options": [
            "能",
            "不能"
        ]
    },
    {
        "audioFile": "audio1.mp3",
        "start": 0.003528,
        "end": 0.065464,
        "correctAnswer": "不能",
        "translation": "一般来说rất 可以跟否定副词không 一起使用吗？",
        "options": [
            "能",
            "不能"
        ]
    },
    {
        "audioFile": "audio1.mp3",
        "start": 0.003528,
        "end": 0.065464,
        "correctAnswer": "不对",
        "translation": "这结构对嘛：không + 形容词 + quá？",
        "options": [
            "不对",
            "对"
        ]
   },
    {
        "audioFile": "audio1.mp3",
        "start": 0.003528,
        "end": 0.065464,
        "correctAnswer": "对",
        "translation": "这结构对嘛：không + 形容词 + lắm？",
        "options": [
            "不对",
            "对"
        ]
    },
    {
        "audioFile": "audio1.mp3",
        "start": 0.003528,
        "end": 0.065464,
        "correctAnswer": "对",
        "translation": "这结构对嘛：không + quá + 形容词？",
        "options": [
            "不对",
            "对"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 96.271542,
        "end": 97.981542,
        "correctAnswer": "Quả dứa ấy không chua.",
        "translation": "那个菠萝不酸。",
        "options": [
            "Quả dứa ấy không chua.",
            "Quả dứa ấy khong chua.",
            "Quả đứa ấy không chua.",
            "Quả dứa ấy không chuô."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 98.431542,
        "end": 100.081542,
        "correctAnswer": "Quả dứa ấy chua lắm.",
        "translation": "那个菠萝非常酸。",
        "options": [
            "Quả dứa ấy chua lắm.",
            "Quả dứa ấy chua lám.",
            "Quả dứa ấy chua lẳm.",
            "Quả dứa ấy chua lãm."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 100.671542,
        "end": 102.631542,
        "correctAnswer": "Quả dứa ấy không chua lắm.",
        "translation": "那个菠萝不太酸。",
        "options": [
            "Quả dứa ấy không chua lắm.",
            "Quả dứa ấy khong chua lắm.",
            "Quả dứa ấy không chua lẳm.",
            "Quả đứa ấy không chua lắm."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 103.221542,
        "end": 105.001542,
        "correctAnswer": "Quả dứa ấy rất chua.",
        "translation": "那个菠萝很酸。",
        "options": [
            "Quả dứa ấy rất chua.",
            "Quả dứa ấy rát chua.",
            "Quả dứa ấy rất chuô.",
            "Quả dứa ấy rớt chua."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 105.331542,
        "end": 106.291542,
        "correctAnswer": "Chua quá !",
        "translation": "太酸了！",
        "options": [
            "Chua quá !",
            "Chưa quá !",
            "Chua quả !",
            "Chụa quá !"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 106.821542,
        "end": 108.651542,
        "correctAnswer": "Quả dưa hấu này thế nào?",
        "translation": "这个西瓜怎么样？",
        "options": [
            "Quả dưa hấu này thế nào?",
            "Quả dưa hấu này thê nào?",
            "Quả dưa hấu này thể nào?",
            "Quả dưa háu này thế nào?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 109.041542,
        "end": 111.091542,
        "correctAnswer": "Quả dưa hấu này có ngon không?",
        "translation": "这个西瓜好吃吗？",
        "options": [
            "Quả dưa hấu này có ngon không?",
            "Quả dưa hấu này có ngôn không?",
            "Quả dưa hấu này có ngon khong?",
            "Quả dưa hấu này cố ngon không?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 111.471542,
        "end": 112.531542,
        "correctAnswer": "thế nào?",
        "translation": "怎么样？",
        "options": [
            "thế nào?",
            "thê nào?",
            "thể nào?",
            "thế nào"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 113.001542,
        "end": 114.101542,
        "correctAnswer": "ngon không?",
        "translation": "好吃吗？",
        "options": [
            "ngon không?",
            "ngon khong?",
            "ngôn không?",
            "ngon khống?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 114.761542,
        "end": 115.921542,
        "correctAnswer": "quá ngon !",
        "translation": "太好吃了！",
        "options": [
            "quá ngon !",
            "quả ngon !",
            "quá ngôn !",
            "quà ngon !"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 116.531542,
        "end": 117.641542,
        "correctAnswer": "rất ngon.",
        "translation": "非常好吃。",
        "options": [
            "rất ngon.",
            "rát ngon.",
            "rấc ngon.",
            "rất ngôn."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 118.031542,
        "end": 119,
        "correctAnswer": "ngon lắm.",
        "translation": "好吃极了。",
        "options": [
            "ngon lắm.",
            "ngôn lắm.",
            "ngon lám.",
            "ngon lãm."
        ]
    }
];

        let currentIndex = 0;
        let isFreeMode = true;
        let correctCount = 0;
        let isPlaying = false;
        let correctSentences = new Set();
        let wrongSentences = new Set();
        let autoContinue = false;
        let showAnswer = false;
        let userAnswers = [];

        // Fisher-Yates shuffle algorithm
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function init() {
            updateSentenceDisplay();
        }

        function updateSentenceDisplay() {
            sentenceNumber.value = currentIndex + 1;
            indicator.style.background = '#ffffe0';
            if (isFreeMode && showAnswer) {
                indicator.innerHTML = `
                    <div style="font-size: 18px; font-weight: bold; color: #85ae5f;">${sentences[currentIndex].translation}</div>
                `;
            } else {
                indicator.innerHTML = '';
            }
            updateOptions();
            if (!isFreeMode) updateScore();
        }

        function updateOptions() {
            optionsContainer.innerHTML = '';
            const shuffledOptions = shuffleArray(sentences[currentIndex].options);
            shuffledOptions.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'optionBtn';
                btn.textContent = option;
                btn.onclick = () => checkAnswer(option);
                optionsContainer.appendChild(btn);
            });
        }

        function playCurrentSentence() {
            if (isPlaying) audio.pause();
            buttons.forEach(btn => btn.classList.add('disabled'));
            sentenceNumber.disabled = true;
            isPlaying = true;
            audio.src = sentences[currentIndex].audioFile;
            audio.currentTime = sentences[currentIndex].start;
            audio.play().catch(error => {
                console.error('Audio playback failed:', error);
                alert('Vui lòng nhấn nút “再听一遍” để phát âm thanh.');
                buttons.forEach(btn => btn.classList.remove('disabled'));
                sentenceNumber.disabled = false;
                isPlaying = false;
            });

            audio.ontimeupdate = () => {
                if (audio.currentTime >= sentences[currentIndex].end) {
                    audio.pause();
                    audio.ontimeupdate = null;
                    buttons.forEach(btn => btn.classList.remove('disabled'));
                    sentenceNumber.disabled = false;
                    isPlaying = false;
                }
            };
        }

        function moveSentence(direction) {
            currentIndex = (currentIndex + direction + sentences.length) % sentences.length;
            updateSentenceDisplay();
            playCurrentSentence();
        }

        function checkAnswer(selectedAnswer) {
            const correctAnswer = sentences[currentIndex].correctAnswer;
            const optionButtons = optionsContainer.getElementsByClassName('optionBtn');
            
            // Clear previous styles
            for (let btn of optionButtons) {
                btn.classList.remove('correct', 'wrong');
                btn.disabled = !isFreeMode; // Only disable buttons in Test Mode
            }

            // Find and style the selected button
            for (let btn of optionButtons) {
                if (btn.textContent === selectedAnswer) {
                    if (selectedAnswer === correctAnswer) {
                        indicator.style.background = '#B7D7AA';
                                                indicator.innerHTML = `
                    <div style="font-size: 18px; font-weight: bold; color: #000000;">${sentences[currentIndex].translation}</div>
                `;
                        btn.classList.add('correct');
                        correctAudio.play().catch(error => {
                            console.error('Correct audio playback failed:', error);
                        });
                    } else {
                        indicator.style.background = '#CE6D5E';
                                                indicator.innerHTML = `
                    <div style="font-size: 18px; font-weight: bold; color: #000000;">${sentences[currentIndex].translation}</div>
                `;
                        btn.classList.add('wrong');
                        wrongAudio.play().catch(error => {
                            console.error('Wrong audio playback failed:', error);
                        });
                    }
                }
            }

            if (!isFreeMode) {
                userAnswers[currentIndex] = selectedAnswer;
                if (selectedAnswer === correctAnswer && !correctSentences.has(currentIndex)) {
                    correctCount++;
                    correctSentences.add(currentIndex);
                    wrongSentences.delete(currentIndex);
                } else if (selectedAnswer !== correctAnswer && !correctSentences.has(currentIndex)) {
                    wrongSentences.add(currentIndex);
                }
                updateScore();

                // Auto-move to next sentence in Test Mode
                const audioToWait = (selectedAnswer === correctAnswer) ? correctAudio : wrongAudio;
                audioToWait.onended = () => {
                    if (userAnswers.length === sentences.length) {
                        showResults();
                    } else {
                        setTimeout(() => {
                            moveSentence(1);
                        }, 200);
                    }
                };
            } else if (isFreeMode && autoContinue && selectedAnswer === correctAnswer) {
                // Auto-move in Free Mode only if answer is correct and autoContinue is enabled
                correctAudio.onended = () => {
                    setTimeout(() => {
                        moveSentence(1);
                    }, 200);
                };
            } else {
                correctAudio.onended = null;
                wrongAudio.onended = null;
            }
        }

        function updateScore() {
            scoreDisplay.textContent = `${correctCount}/${sentences.length}`;
            scoreDisplay.style.display = 'block'; // Hiển thị score trong Test Mode
        }

        function showResults() {
            let resultText = `练习完成！\n正确答案数量：${correctCount}/${sentences.length}\n正确率：${((correctCount / sentences.length) * 100).toFixed(2)}%\n错误题目：`;
            wrongSentences.forEach(index => {
                resultText += `\n第${index + 1}题：\n你的选择：${userAnswers[index] || '未选择'}\n正确答案：${sentences[index].correctAnswer}\n`;
            });
            if (wrongSentences.size === 0) {
                resultText += '\n全部正确！';
            }
            resultsDisplay.textContent = resultText;
            resultsDisplay.style.display = 'block';
        }

        prevBtn.onclick = () => {
            moveSentence(-1);
        };

        nextBtn.onclick = () => {
            moveSentence(1);
        };

        replayBtn.onclick = () => {
            playCurrentSentence();
        };

        freeModeBtn.onclick = () => {
            isFreeMode = true;
            freeModeBtn.classList.add('active-mode');
            testModeBtn.classList.remove('active-mode');
            autoContinueBtn.disabled = false;
            autoContinueBtn.classList.remove('disabled');
            showHideBtn.disabled = false;
            showHideBtn.classList.remove('disabled');
            scoreDisplay.style.display = 'none';
            wrongSentencesDisplay.style.display = 'none';
            resultsDisplay.style.display = 'none';
            updateSentenceDisplay();
        };

        testModeBtn.onclick = () => {
            isFreeMode = false;
            testModeBtn.classList.add('active-mode');
            freeModeBtn.classList.remove('active-mode');
            autoContinueBtn.disabled = true;
            autoContinueBtn.classList.add('disabled');
            showHideBtn.disabled = true;
            showHideBtn.classList.add('disabled');
            showHideBtn.classList.remove('active-mode');
            showAnswer = false;
            scoreDisplay.style.display = 'block';
            currentIndex = 0;
            correctCount = 0;
            correctSentences.clear();
            wrongSentences.clear();
            userAnswers = [];
            for (let i = 0; i < sentences.length; i++) {
                wrongSentences.add(i);
            }
            updateSentenceDisplay();
        };

        autoContinueBtn.onclick = () => {
            if (isFreeMode) {
                autoContinue = !autoContinue;
                autoContinueBtn.classList.toggle('active-mode');
                if (!autoContinue) {
                    correctAudio.onended = null;
                }
            }
        };

        showHideBtn.onclick = () => {
            if (isFreeMode) {
                showAnswer = !showAnswer;
                showHideBtn.classList.toggle('active-mode');
                updateSentenceDisplay();
            }
        };

        sentenceNumber.onchange = () => {
            if (!isPlaying) {
                const num = parseInt(sentenceNumber.value) - 1;
                if (!isNaN(num) && num >= 0 && num < sentences.length) {
                    currentIndex = num;
                    updateSentenceDisplay();
                    playCurrentSentence();
                } else {
                    alert(`输入范围： 1 到 ${sentences.length}`);
                    updateSentenceDisplay();
                }
            }
        };

        sentenceNumber.onkeydown = (e) => {
            if (!isPlaying) {
                if (e.key === 'ArrowLeft') {
                    moveSentence(-1);
                }
                if (e.key === 'ArrowRight') {
                    moveSentence(1);
                }
            }
        };

        init();
    </script>
</body>
</html>